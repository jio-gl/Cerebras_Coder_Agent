\begin{tikzpicture}[
    node distance=1.5cm,
    auto,
    block/.style={rectangle, draw, fill=blue!20, text width=2.5cm, text centered, rounded corners, minimum height=1cm},
    cloud/.style={draw, ellipse, fill=red!20, node distance=3cm, minimum height=2em},
    line/.style={draw, -latex'},
    data/.style={rectangle, draw, fill=green!20, text width=2cm, text centered, rounded corners, minimum height=0.8cm}
]

% Input Layer
\node [cloud] (user) {User Query};

% Core Agent Layer
\node [block, below of=user] (parser) {Query Parser \& Intent Classifier};
\node [block, below of=parser] (orchestrator) {Tool Orchestrator};
\node [block, left of=orchestrator, xshift=-3cm] (context) {Context Manager};
\node [block, right of=orchestrator, xshift=3cm] (memory) {Conversation Memory};

% Tool Layer
\node [block, below of=orchestrator, yshift=-1cm] (file_ops) {File Operations};
\node [block, left of=file_ops, xshift=-2cm] (code_analysis) {Code Analysis};
\node [block, right of=file_ops, xshift=2cm] (llm_toolkit) {LLM Toolkit};

% LLM Interface Layer
\node [block, below of=file_ops, yshift=-1cm] (llm_interface) {LLM Interface};
\node [data, left of=llm_interface, xshift=-2cm] (prompt_eng) {Prompt Engineering};
\node [data, right of=llm_interface, xshift=2cm] (response_proc) {Response Processing};

% Cerebras Layer
\node [cloud, below of=llm_interface, fill=orange!20] (cerebras) {Cerebras Inference};

% Output Layer
\node [block, below of=cerebras] (formatter) {Response Formatter};
\node [cloud, below of=formatter] (output) {Structured Output};

% Connections
\path [line] (user) -- (parser);
\path [line] (parser) -- (orchestrator);
\path [line] (context) -- (orchestrator);
\path [line] (memory) -- (orchestrator);
\path [line] (orchestrator) -- (file_ops);
\path [line] (orchestrator) -- (code_analysis);
\path [line] (orchestrator) -- (llm_toolkit);
\path [line] (file_ops) -- (llm_interface);
\path [line] (code_analysis) -- (llm_interface);
\path [line] (llm_toolkit) -- (llm_interface);
\path [line] (prompt_eng) -- (llm_interface);
\path [line] (llm_interface) -- (response_proc);
\path [line] (llm_interface) -- (cerebras);
\path [line] (cerebras) -- (formatter);
\path [line] (formatter) -- (output);

% Feedback loops
\path [line, dashed, bend right=45] (output) to (context);
\path [line, dashed, bend left=45] (output) to (memory);

\end{tikzpicture} 