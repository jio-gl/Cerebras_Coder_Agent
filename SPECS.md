# Coding Agent v1 Specification

## Overview

The Coding Agent is a minimalistic, language-agnostic, self-improving coding assistant that leverages the OpenRouter API (with Cerebras provider) for LLM-powered code generation, editing, and repository tooling. It is designed for robust, automated, and test-driven codebase management with a unique nested versioning system that enables continuous self-improvement.

## Goals
- Minimal, clean, and robust design
- Language-agnostic file and directory tooling
- Self-rewrite and self-healing capabilities
- Comprehensive test coverage
- Backward compatibility between versions
- Nested versioning system for continuous improvement

## Core Features

### 1. Self-Rewrite System
The agent's primary feature is its ability to rewrite and improve itself through a nested versioning system:

- **Version Generation**: Each version can generate its successor in a dedicated directory
  ```
  .
  ├── coder/                 # Version 1 implementation
  ├── version2/             # Generated by Version 1
  │   ├── coder/           # Version 2 implementation
  │   └── version3/        # Generated by Version 2
  │       └── coder/       # Version 3 implementation
  ```

- **Installation Process**:
  ```bash
  # Initial Version 1
  pip install -e .
  python -m coder.cli --self-rewrite  # Generates version2/

  # Move to Version 2
  cd version2
  pip install -e .
  python -m coder.cli --self-rewrite  # Generates version3/

  # Move to Version 3
  cd version3
  pip install -e .
  ```

- **Version Directory Structure**:
  ```
  version{N}/
  ├── coder/           # Package implementation
  ├── tests/           # Test suite
  ├── setup.py         # Installation configuration
  ├── requirements.txt # Dependencies
  ├── README.md        # Documentation
  └── SPECS.md         # Version-specific specifications
  ```

### 2. OpenRouter API Integration
- Uses OpenRouter API with Cerebras provider (qwen/qwen-3-32b)
- Environment variable configuration: `OPENROUTER_API_KEY`
- Robust error handling with retries

### 3. File Operations
- Reading and writing with proper encoding
- Directory manipulation
- Cross-platform path handling

### 4. Error Handling
- Descriptive error messages
- Automatic retries for API calls
- Clean failure recovery

### 5. Testing Framework
- Comprehensive test suite
- Integration tests
- Coverage reporting

### 6. CLI Interface
- Command-line tools
- Progress visualization
- Error reporting

## Implementation Details

### Directory Structure
```
.
├── coder/
│   ├── __init__.py
│   ├── agent.py
│   └── cli.py
├── tests/
│   └── test_agent.py
├── setup.py
└── SPECS.md
```

### Dependencies
- Python 3.10+
- OpenRouter API access
- Required packages:
  ```
  tqdm>=4.64.0
  rich>=13.0.0
  click>=8.1.0
  python-dotenv>=0.21.0
  ```

### Installation
```bash
pip install -e .
```

### Usage
```bash
# Generate and install next version
python -m coder.cli --self-rewrite
cd version2
pip install -e .

# Generate version after that
python -m coder.cli --self-rewrite
cd version3
pip install -e .
```

## Error Handling

### API Errors
- Exponential backoff
- Clear error messages

### File System Errors
- Permission validation
- Path sanitization

## Testing

### Test Coverage
- Core functionality
- API integration
- File operations
- Error cases

### Running Tests
```bash
pytest tests/
```

## Contributing

### Development Setup
1. Clone repository
2. Install dependencies: `pip install -e ".[dev]"`
3. Configure API key: `export OPENROUTER_API_KEY=your-key`

### Code Style
- PEP 8 compliant
- Type annotations
- Detailed docstrings

## Version Control

### Git Structure
- Main branch: stable releases
- Feature branches: development
- Version tags: releases

### Version Numbering
- Semantic versioning
- Version in setup.py and __init__.py

## Known Issues
- None currently

## Future Improvements
- Enhanced error recovery
- Additional file formats
- Performance optimization 
- Performance optimizations 